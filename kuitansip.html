<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Kuitansi Resmi MOYA</title>
  <link rel="stylesheet" href="kuitansi.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

  <div class="receipt-container" id="receipt">
    <div class="receipt-header">
      <h1>MOYA</h1>
      <p>Mata Air Pegunungan Turi</p>
    </div>

    <div class="receipt-body">
      <div class="receipt-id" id="v-id">M-----</div>

      <div class="info-group">
        <span class="info-label">Telah Diterima Dari:</span>
        <div class="info-value" id="v-nama" style="font-size: 20px; color: var(--deep);">Memuat...</div>
      </div>

      <div class="info-group">
        <span class="info-label">Guna Pembayaran:</span>
        <div class="info-value" id="v-ket">...</div>
      </div>

      <div class="amount-card">
        <span class="info-label" style="color: var(--primary);">Jumlah Pembayaran</span>
        <h2 id="v-amt">Rp 0</h2>
      </div>

      <div class="info-group">
        <span class="info-label">Tanggal Transaksi:</span>
        <div class="info-value" id="v-tgl">...</div>
      </div>
    </div>

    <div class="receipt-footer">
      <div class="verified">
        <i class="fas fa-check-circle"></i> VERIFIED BY MOYA
      </div>
      <div style="text-align: right;">
        <img src="" id="v-qr" width="45" style="border-radius: 5px;">
      </div>
    </div>
  </div>

  <button class="btn-download" onclick="window.print()">
    <i class="fas fa-file-pdf"></i> Simpan / Cetak
  </button>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzUQCPbV8f7sWIx1PMm0XLAQtA_DKgZoHHhI6HdM6xbIGp5a7zUkgoCdGp8IDyUVRAB/exec";
    const urlParams = new URLSearchParams(window.location.search);
    const trxId = urlParams.get('id');

    async function loadReceipt() {
      if (!trxId) {
        document.getElementById('v-nama').innerText = "ID TIDAK DITEMUKAN";
        return;
      }
      
      try {
        const res = await fetch(`${API_URL}?id=${trxId}`);
        const d = await res.json();
        
        if (d.error) {
          document.getElementById('v-nama').innerText = "DATA TIDAK DITEMUKAN";
          return;
        }

        document.getElementById('v-id').innerText = d.id;
        document.getElementById('v-nama').innerText = d.nama || "Pelanggan";
        document.getElementById('v-ket').innerText = d.ket || "Penjualan Galon";
        
        const nominal = Number(d.nominal);
        document.getElementById('v-amt').innerText = "Rp " + (isNaN(nominal) ? "0" : nominal.toLocaleString('id-ID'));
        
        const tglObj = new Date(d.tgl);
        document.getElementById('v-tgl').innerText = isNaN(tglObj) ? d.tgl : tglObj.toLocaleDateString('id-ID', { 
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
        });
        
        document.getElementById('v-qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${window.location.href}`;
        
      } catch (e) {
        document.getElementById('v-nama').innerText = "GAGAL MEMUAT DATA";
      }
    }
    window.onload = loadReceipt;
  </script>
</body>
</html>
