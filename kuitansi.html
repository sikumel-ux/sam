<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kuitansi Resmi MOYA</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root { --primary: #00B7EB; --grad-end: #008fa4; --deep: #006b7a; --bg: #f0f9ff; }
    body { background-color: var(--bg); font-family: 'Inter', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
    .receipt-container { background: white; width: 100%; max-width: 400px; border-radius: 30px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.1); position: relative; }
    .receipt-header { background: linear-gradient(135deg, var(--primary), var(--grad-end)); padding: 40px 20px; text-align: center; color: white; border-bottom-left-radius: 80px; }
    .receipt-header h1 { margin: 0; font-size: 2.5rem; font-weight: 900; text-shadow: 2px 3px var(--deep); }
    .receipt-body { padding: 30px; position: relative; }
    .receipt-id { position: absolute; top: -25px; right: 30px; background: white; padding: 8px 15px; border-radius: 15px; font-weight: 800; font-size: 12px; color: var(--deep); border: 1px solid #eee; }
    .info-group { margin-bottom: 20px; }
    .info-label { font-size: 11px; color: #999; text-transform: uppercase; font-weight: 700; display: block; }
    .info-value { font-size: 16px; color: #333; font-weight: 600; }
    .amount-card { background: #f8fdff; border-radius: 20px; padding: 20px; border: 2px dashed #00B7EB; text-align: center; margin: 20px 0; }
    .amount-card h2 { margin: 0; font-size: 28px; color: var(--primary); font-weight: 900; }
    .receipt-footer { background: #fafafa; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; }
    .btn-download { position: fixed; bottom: 20px; background: var(--deep); color: white; border: none; padding: 12px 25px; border-radius: 50px; font-weight: bold; cursor: pointer; }
    @media print { .btn-download { display: none; } }
  </style>
</head>
<body>

  <div class="receipt-container" id="receipt">
    <div class="receipt-header">
      <h1>MOYA</h1>
      <p>Mata Air Pegunungan Turi</p>
    </div>

    <div class="receipt-body">
      <div class="receipt-id" id="v-id">M-----</div>

      <div class="info-group">
        <span class="info-label">Telah Diterima Dari:</span>
        <div class="info-value" id="v-nama" style="font-size: 20px; color: var(--deep);">Memuat...</div>
      </div>

      <div class="info-group">
        <span class="info-label">Guna Pembayaran:</span>
        <div class="info-value" id="v-ket">...</div>
      </div>

      <div class="amount-card">
        <span class="info-label" style="color: var(--primary);">Jumlah Pembayaran</span>
        <h2 id="v-amt">Rp 0</h2>
      </div>

      <div class="info-group">
        <span class="info-label">Tanggal Transaksi:</span>
        <div class="info-value" id="v-tgl">...</div>
      </div>
    </div>

    <div class="receipt-footer">
      <div style="color: #4caf50; font-size: 11px; font-weight: 800;">
        <i class="fas fa-check-circle"></i> VERIFIED BY MOYA
      </div>
      <img src="" id="v-qr" width="50" style="border-radius: 5px;">
    </div>
  </div>

  <button class="btn-download" onclick="window.print()">
    <i class="fas fa-print"></i> Cetak Kuitansi
  </button>

  <script>
    // URL API BARU LO
    const API_URL = "https://script.google.com/macros/s/AKfycbzUQCPbV8f7sWIx1PMm0XLAQtA_DKgZoHHhI6HdM6xbIGp5a7zUkgoCdGp8IDyUVRAB/exec";
    
    const urlParams = new URLSearchParams(window.location.search);
    const trxId = urlParams.get('id');

    async function loadReceipt() {
      if (!trxId) {
        document.getElementById('v-nama').innerText = "ID TIDAK DITEMUKAN";
        return;
      }
      
      try {
        const res = await fetch(`${API_URL}?id=${trxId}`);
        const d = await res.json();
        
        if (d.error) {
          document.getElementById('v-nama').innerText = "DATA TIDAK DITEMUKAN";
          return;
        }

        // ISI DATA KE HTML (Sesuai dengan JSON dari API baru)
        document.getElementById('v-id').innerText = d.id;
        document.getElementById('v-nama').innerText = d.nama || "Pelanggan";
        document.getElementById('v-ket').innerText = d.ket || "Penjualan Galon";
        
        // Format Angka
        const nominal = Number(d.nominal);
        document.getElementById('v-amt').innerText = "Rp " + (isNaN(nominal) ? "0" : nominal.toLocaleString('id-ID'));
        
        // Format Tanggal
        const tglObj = new Date(d.tgl);
        document.getElementById('v-tgl').innerText = isNaN(tglObj) ? d.tgl : tglObj.toLocaleDateString('id-ID', { 
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
        });
        
        // QR Code
        document.getElementById('v-qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${window.location.href}`;
        
      } catch (e) {
        document.getElementById('v-nama').innerText = "GAGAL MEMUAT DATA";
      }
    }
    window.onload = loadReceipt;
  </script>
</body>
</html>
