<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuitansi MOYA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: sans-serif; background: #f0f9ff; display: flex; justify-content: center; padding: 20px; }
        .receipt { background: white; padding: 30px; border-radius: 20px; width: 100%; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #00B7EB; margin-bottom: 20px; }
        .line { border-bottom: 2px dashed #eee; margin: 15px 0; }
        .val { font-weight: bold; color: #333; display: block; margin-bottom: 10px; }
        .label { color: #999; font-size: 12px; text-transform: uppercase; }
        .amt { font-size: 24px; color: #00B7EB; text-align: center; margin: 20px 0; font-weight: 900; }
    </style>
</head>
<body>
    <div id="loading">Memuat Kuitansi...</div>
    <div class="receipt" id="receipt" style="display:none">
        <div class="header"><h1>MOYA</h1><p>Kuitansi Digital</p></div>
        <div class="line"></div>
        <span class="label">ID Transaksi</span><span class="val" id="v-id"></span>
        <span class="label">Diterima Dari</span><span class="val" id="v-nama"></span>
        <span class="label">Keterangan</span><span class="val" id="v-ket"></span>
        <div class="amt" id="v-amt"></div>
        <span class="label">Tanggal</span><span class="val" id="v-tgl"></span>
        <div class="line"></div>
        <center><img id="v-qr" width="100"></center>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxsUJ_vgSx3m1sXCcHkbBN-gFPyt5EjO2IMTXbHQPeWOEcqoy544jAB5XPznrfh6018cw/exec";
        const trxId = new URLSearchParams(window.location.search).get('id');

        async function load() {
            if(!trxId) return;
            try {
                const res = await fetch(`${API_URL}?id=${trxId}`);
                const data = await res.json();
                if(data.error) { document.getElementById('loading').innerText = "Data tidak ditemukan"; return; }

                document.getElementById('v-id').innerText = data.id;
                document.getElementById('v-nama').innerText = data.nama || "Pelanggan";
                document.getElementById('v-ket').innerText = data.ket || "Isi Ulang Galon";
                document.getElementById('v-amt').innerText = "Rp " + Number(data.nominal).toLocaleString('id-ID');
                
                const d = new Date(data.tgl);
                document.getElementById('v-tgl').innerText = isNaN(d) ? data.tgl : d.toLocaleDateString('id-ID', { dateStyle: 'full' });
                document.getElementById('v-qr').src = `https://api.qrserver.com/v1/create-qr-code/?data=${window.location.href}`;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('receipt').style.display = 'block';
            } catch(e) { document.getElementById('loading').innerText = "Gagal memuat data"; }
        }
        load();
    </script>
</body>
</html>
