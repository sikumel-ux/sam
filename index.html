<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>MOYA Sales App</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app-container">
  <header class="header">
    <h1 class="moya-logo">MOYA</h1>
    <p class="tagline">Dari mata air pegunungan turi</p>
  </header>

  <div class="content">
    <section id="kas" class="page active">
      <div class="card">
        <h3 style="color:var(--deep); margin:0 0 20px 0;"><i class="fas fa-wallet mr-2"></i> Transaksi Kas</h3>
        
        <span class="label">Tanggal</span>
        <input type="date" id="k-tgl">
        
        <span class="label">Tipe Arus</span>
        <div class="type-selector">
          <button onclick="setType('Masuk')" id="b-masuk" class="btn-type active">MASUK</button>
          <button onclick="setType('Keluar')" id="b-keluar" class="btn-type">KELUAR</button>
        </div>

        <span class="label">Jumlah Nominal</span>
        <input type="number" id="k-amt" placeholder="Rp 0">
        
        <span class="label">Keterangan Tambahan</span>
        <textarea id="k-desc" placeholder="Catatan transaksi..."></textarea>
        
        <button onclick="saveToGAS('KAS')" id="btn-kas" class="btn-submit">Simpan Transaksi</button>
      </div>
    </section>

    <section id="pelanggan" class="page">
      <div class="card">
        <h3 style="color:var(--deep); margin:0 0 20px 0;"><i class="fas fa-users-cog mr-2"></i> Database Pelanggan</h3>
        <span class="label">Nama Lengkap</span>
        <input type="text" id="p-nama" placeholder="Input nama...">
        <span class="label">WhatsApp</span>
        <input type="tel" id="p-wa" placeholder="08xxxxxxxxxx">
        <button onclick="saveToGAS('Pelanggan')" id="btn-cust" class="btn-submit">Daftarkan Pelanggan</button>
      </div>
    </section>
  </div>

  <nav>
    <button onclick="nav('kas', this)" class="nav-item active"><i class="fas fa-home"></i><span>Home</span></button>
    <button onclick="nav('kuitansi', this)" class="nav-item"><i class="fas fa-file-invoice"></i><span>Kuitansi</span></button>
    <button onclick="nav('pelanggan', this)" class="nav-item"><i class="fas fa-user-friends"></i><span>Pelanggan</span></button>
  </nav>
</div>

<script>
  // GANTI DENGAN URL WEB APP GAS ANDA
  const API_URL = "GANTI_URL_WEB_APP_GAS_LO_DISINI"; 
  
  let currentType = 'Masuk';
  document.getElementById('k-tgl').valueAsDate = new Date();

  function nav(id, el) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    el.classList.add('active');
  }

  function setType(t) {
    currentType = t;
    document.getElementById('b-masuk').classList.toggle('active', t === 'Masuk');
    document.getElementById('b-keluar').classList.toggle('active', t === 'Keluar');
  }

  async function saveToGAS(target) {
    const btn = event.target;
    let payload = { sheet: target, data: [] };

    if(target === 'KAS') {
      const amt = document.getElementById('k-amt').value;
      if(!amt) return alert("Nominal wajib diisi, Bro!");
      payload.data = [document.getElementById('k-tgl').value, currentType, amt, document.getElementById('k-desc').value, new Date().toLocaleString()];
    } else {
      const nama = document.getElementById('p-nama').value;
      if(!nama) return alert("Nama jangan dikosongin!");
      payload.data = [nama, document.getElementById('p-wa').value, new Date().toLocaleString()];
    }

    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> MEMPROSES...';

    try {
      // Menggunakan mode no-cors untuk integrasi GAS sederhana
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      
      alert("Mantap! Data MOYA berhasil diamankan ke Google Sheets.");
      // Reset Form
      if(target === 'KAS') { document.getElementById('k-amt').value = ''; document.getElementById('k-desc').value = ''; }
      else { document.getElementById('p-nama').value = ''; document.getElementById('p-wa').value = ''; }
      
    } catch (e) {
      alert("Waduh, gagal simpan: " + e.toString());
    } finally {
      btn.disabled = false;
      btn.innerText = target === 'KAS' ? "SIMPAN TRANSAKSI" : "DAFTARKAN PELANGGAN";
    }
  }
</script>
</body>
</html>
