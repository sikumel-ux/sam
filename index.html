<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>MOYA - Sales & Kas</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app-container">
  <header class="header">
    <h1 class="moya-logo">MOYA</h1>
    <p class="tagline">Dari mata air pegunungan turi</p>
  </header>

  <main class="content">
    
    <section id="kas" class="page active">
      <div class="card">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; color: #006b7a;">
          <i class="fas fa-cash-register text-xl"></i>
          <h2 style="margin:0; font-size: 1.2rem;">Catat KAS</h2>
        </div>

        <span class="label">Tanggal Transaksi</span>
        <input type="date" id="k-tgl">
        
        <span class="label">Jenis Transaksi</span>
        <div class="type-selector">
          <button onclick="setType('Masuk')" id="b-masuk" class="btn-type active">MASUK</button>
          <button onclick="setType('Keluar')" id="b-keluar" class="btn-type">KELUAR</button>
        </div>

        <span class="label">Nominal (Rp)</span>
        <input type="number" id="k-amt" placeholder="0" inputmode="numeric">
        
        <span class="label">Keterangan</span>
        <textarea id="k-desc" rows="3" placeholder="Contoh: Penjualan air galon..."></textarea>
        
        <button onclick="saveData('KAS')" id="btn-kas" class="btn-submit">
          <i class="fas fa-save mr-2"></i> Simpan Transaksi
        </button>
      </div>
    </section>

    <section id="pelanggan" class="page">
      <div class="card">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; color: #006b7a;">
          <i class="fas fa-user-plus text-xl"></i>
          <h2 style="margin:0; font-size: 1.2rem;">Data Pelanggan</h2>
        </div>
        
        <span class="label">Nama Lengkap</span>
        <input type="text" id="p-nama" placeholder="Nama Pelanggan">
        
        <span class="label">Nomor WhatsApp</span>
        <input type="tel" id="p-wa" placeholder="08xxxxxxxxxx" inputmode="tel">
        
        <button onclick="saveData('Pelanggan')" id="btn-cust" class="btn-submit">
          <i class="fas fa-check-circle mr-2"></i> Daftarkan Pelanggan
        </button>
      </div>
    </section>

  </main>

  <nav>
    <button onclick="nav('kas', this)" class="nav-item active">
      <i class="fas fa-home"></i>
      <span>Beranda</span>
    </button>
    <button onclick="nav('kuitansi', this)" class="nav-item">
      <i class="fas fa-file-invoice"></i>
      <span>Kuitansi</span>
    </button>
    <button onclick="nav('pelanggan', this)" class="nav-item">
      <i class="fas fa-users"></i>
      <span>Pelanggan</span>
    </button>
  </nav>
</div>

<script>
  // URL GAS lo yang sudah dideploy sebagai Web App
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxsUJ_vgSx3m1sXCcHkbBN-gFPyt5EjO2IMTXbHQPeWOEcqoy544jAB5XPznrfh6018cw/exec";
  
  let currentType = 'Masuk';
  document.getElementById('k-tgl').valueAsDate = new Date();

  // Fungsi Navigasi Tab
  function nav(pageId, element) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    document.getElementById(pageId).classList.add('active');
    element.classList.add('active');
  }

  // Fungsi Pilih Jenis Kas (Masuk/Keluar)
  function setType(type) {
    currentType = type;
    document.getElementById('b-masuk').classList.toggle('active', type === 'Masuk');
    document.getElementById('b-keluar').classList.toggle('active', type === 'Keluar');
  }

  // Fungsi Kirim Data ke Google Sheets via GAS
  async function saveData(target) {
    const btn = event.currentTarget;
    const originalText = btn.innerHTML;
    let payload = { sheet: target, data: [] };

    // Validasi & Siapkan Data
    if (target === 'KAS') {
      const amt = document.getElementById('k-amt').value;
      if (!amt) return alert("Nominal harus diisi!");
      payload.data = [
        document.getElementById('k-tgl').value,
        currentType,
        amt,
        document.getElementById('k-desc').value,
        new Date().toLocaleString('id-ID')
      ];
    } else {
      const nama = document.getElementById('p-nama').value;
      if (!nama) return alert("Nama tidak boleh kosong!");
      payload.data = [
        nama,
        document.getElementById('p-wa').value,
        new Date().toLocaleString('id-ID')
      ];
    }

    // Loading State
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Memproses...';

    try {
      await fetch(WEB_APP_URL, {
        method: 'POST',
        mode: 'no-cors', // Penting untuk bypass CORS Google Apps Script
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      
      alert(`Berhasil! Data ${target} MOYA tersimpan.`);
      
      // Reset Form
      if (target === 'KAS') {
        document.getElementById('k-amt').value = '';
        document.getElementById('k-desc').value = '';
      } else {
        document.getElementById('p-nama').value = '';
        document.getElementById('p-wa').value = '';
      }
    } catch (error) {
      alert("Waduh, koneksi bermasalah: " + error.message);
    } finally {
      btn.disabled = false;
      btn.innerHTML = originalText;
    }
  }
</script>

</body>
            </html>
  
